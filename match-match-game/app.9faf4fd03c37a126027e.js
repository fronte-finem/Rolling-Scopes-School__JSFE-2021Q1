(()=>{"use strict";const t="logo--2G37ld8du",e="logo--github--3ijQW084b",s="svg--h5sFOs_H3",i="text--2vxeXqF32",a="text--github--RBLMGZLEu",r={url:"./svg/sprite.svg#icon-github",classNames:[s,"svg--github--13qCff62Z"]},n={rss:{link:{url:"https://rs.school/js/",classNames:[t,"logo--rss--2kyrK9XzW"]},text:{tag:"span",text:"'21",classNames:[i,"text--rss--2lrb8Fd_G"]},svg:{url:"./svg/sprite.svg#icon-rs-school-js",classNames:[s,"svg--rss--2OKNwquNN"]}},mentor:{link:{url:"https://github.com/dimonwhite",classNames:[t,e]},text:{tag:"span",text:"mentor: dimonwhite",classNames:[i,a]},svg:r},student:{link:{url:"https://github.com/fronte-finem",classNames:[t,e]},text:{tag:"span",text:"student: fronte-finem",classNames:[i,a]},svg:r}},o="http://www.w3.org/2000/svg";function c({url:t,classNames:e=[]}){const s=document.createElementNS(o,"svg"),i=document.createElementNS(o,"use");return i.setAttribute("href",t),s.append(i),s.classList.add("svg-icon",...e),s}class h{constructor(t){if("string"==typeof t)this.element=function(t){const e=document.createElement("template");return e.innerHTML=t,e.content.firstElementChild}(t);else{const{childs:e,hookElement:s,...i}=t;this.element=function({tag:t="div",classNames:e=[],text:s=""}){const i=document.createElement(t);return i.classList.add(...e),i.textContent=s,i}(i),e&&this.render(e),s&&s(this.element)}}getText(){return this.element.textContent}setText(t){this.element.textContent=t}clear(){return this.element.innerHTML="",this}render(t){return this.clear(),Array.isArray(t)?this.element.append(...t.map((t=>t.element))):this.element.append(t.element),this}setCssState(t,e=!0){this.element.classList.toggle(t,e)}setCssStateAsync(t,e=!0){return this.element.classList.toggle(t,e),new Promise((t=>{this.element.addEventListener("transitionend",(()=>t()),{once:!0})}))}setCssStyle(t,e){this.element.style[t]=e}getCssVar(t){return function(t,e){return getComputedStyle(t).getPropertyValue(e)}(this.element,t)}setCssVar(t,e){!function(t,e,s){t.style.setProperty(e,s)}(this.element,t,e)}onClick(t,e){this.element.addEventListener("click",t,e)}}class l extends h{constructor({url:t,classNames:e,...s}){super({...s,tag:"a",classNames:["link"].concat(e||[])}),this.element.href=t}active(t=!0){this.setCssState("link--active",t)}}const u=({link:t,text:e,svg:s})=>{const i=new l(t),a=new h(e);return i.element.append(c(s),a.element),i};class d extends h{constructor(){super({tag:"footer",classNames:["footer--2ybgr8LPr"]}),this.init()}init(){const t=new h({classNames:["wrapper--2wEjP6GK0"]});t.render([u(n.rss),u(n.mentor),u(n.student)]),this.render(t)}}function m(t){return Object.values(t).forEach((t=>{Object.isFrozen(t)||m(t)})),Object.freeze(t)}const p=m({btns:{signUp:{text:"register new player"},start:{text:"start game"},stop:{text:"stop game"}}});class g{constructor(t,e){this.rows=t,this.columns=e}getCardsAmount(){return this.rows*this.columns}toString(){return`${this.rows} × ${this.columns}`}equal(t){return t.rows===this.rows&&t.columns===this.columns}}function w(t){const e=t;for(let t=e.length-1;t>0;t-=1){const s=Math.floor((t+1)*Math.random());[e[s],e[t]]=[e[t],e[s]]}return e}const v="./images.json";var S;!function(t){t.CATS="cats",t.DOGS="dogs"}(S||(S={}));const f=new Map(Object.values(S).map((t=>[t,t]))),N=m({initialShowTime:[5,10,15,20,25,30],mismatchShowTime:[1,2,3,4,5],cardsField:[[3,4],[4,4],[4,5],[4,6],[5,6],[6,6],[6,7],[6,8],[7,8],[8,8]].map((([t,e])=>new g(t,e)))}),C=m({cardImagesCategory:S.DOGS,cardsField:N.cardsField[5],initialShowTime:N.initialShowTime[1],mismatchShowTime:N.mismatchShowTime[2]});function y(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function b(t){return`${t[0].toUpperCase()}${t.slice(1).toLowerCase()}`}function x(t){return t.split(" ").map(b).join(" ")}const E=()=>new Error("⚠️ Database not opened, created, linked ⚠️");var A;!function(t){t.CREATE="Create",t.READ="Read",t.UPDATE="Update",t.DELETE="Delete"}(A||(A={}));class T{constructor(t,e=1){this.dbName=t,this.dbVersion=e}open(t=1){this.dbVersion=t;const e=window.indexedDB.open(this.dbName,this.dbVersion);return new Promise(((t,s)=>{e.onupgradeneeded=()=>this.onOpen(e.result,t,!0),e.onsuccess=()=>this.onOpen(e.result,t,!1),e.onerror=()=>s(new Error("⚠️ Can't open DB. Probably browser user didn't allow this web app to use IndexedDB? ⚠️"))}))}onOpen(t,e,s=!1){this.db=t,e({db:t,upgradeMode:s})}openTransaction(t,e){if(!this.db)throw E();return this.db.transaction(t,e)}openStore(t,e){if(!this.db)throw E();return this.db.transaction(t,e).objectStore(t)}operate(t,e,s,i){const a=e(this.openStore(t,i));return new Promise(((t,e)=>{a.onsuccess=()=>t(a.result),a.onerror=()=>e(this.errorGenerator(s))}))}create(t,e,s){return this.operate(t,(t=>t.add(e,s)),{operation:A.CREATE,key:s,storeName:t},"readwrite")}read(t,e){return this.operate(t,(t=>t.get(e)),{operation:A.READ,key:e,storeName:t},"readonly")}update(t,e,s){return this.operate(t,(t=>t.put(e,s)),{operation:A.UPDATE,key:s,storeName:t},"readwrite")}delete(t,e){return this.operate(t,(t=>t.delete(e)),{operation:A.DELETE,key:e,storeName:t},"readwrite")}errorGenerator({operation:t,storeName:e,key:s}){return new Error(`⚠️ DB::${this.dbName}.${this.dbVersion}: <${t}> on store "${e}" failed for key "${String(s)}" ⚠️`)}}const I="users",M=t=>`0x${t.toString(16).padStart(4,"0")}`,R=t=>`TEST-${M(t)}-LONG-USER-NAME-ಠ_ಠ`,k=t=>`CAFE-DEAD-BEEF-${M(t)}-BABE-FEED`,L=t=>`test.user${t}@${t}resu.tset`;var F,V;function U({firstName:t,lastName:e,email:s}){return function(t){let e=0;for(let s=0;s<t.length;s+=1)e=Math.imul(31,e)+t.charCodeAt(s);return 0|e}(JSON.stringify({firstName:t,lastName:e,email:s}))}function P(t){const e=y(0,N.cardsField.length-1);return{firstName:R(t),lastName:k(t),email:L(t),score:t/10,time:Math.abs(5e3-40*t),cardsField:N.cardsField[e].toString(),datetime:new Date}}!function(t){t.FIRSTNAME="firstName",t.LASTNAME="lastName",t.EMAIL="email",t.SCORE="score",t.AVATAR="avatar",t.TIME="time",t.CARDSFIELD="cardsField",t.DATETIME="datetime"}(F||(F={})),function(t){t.INITIAL="initial",t.READY="ready",t.GAME="game",t.SOLVED="solved"}(V||(V={}));class D{constructor(t,e,s){this.storageKey=t,this.initialSettings=e,this.serializer=s}load(){const t=window.localStorage.getItem(this.storageKey);return t?this.serializer.deserialize(t):this.initialSettings}save(t){window.localStorage.setItem(this.storageKey,this.serializer.serialize(t))}}const O=new class{init(t){this.requestListener=t}requestStateChange(t){return this.requestListener(t)}},_=new class{constructor(){this.dbService=new T("fronte-finem",1)}get currentUser(){return this.user}async init(t=!1){const{db:e,upgradeMode:s}=await this.dbService.open();if(s){const t=function(t){const e=t.createObjectStore(I);return e.createIndex(F.FIRSTNAME,F.FIRSTNAME),e.createIndex(F.LASTNAME,F.LASTNAME),e.createIndex(F.EMAIL,F.EMAIL),e.createIndex(F.SCORE,F.SCORE),e.createIndex("fullId",[F.FIRSTNAME,F.LASTNAME,F.EMAIL],{unique:!0}),e}(e);await async function(t,e=100){const s=Array.from({length:e},((e,s)=>{const i=P(s),a=U(i);return r=t.add(i,a),new Promise(((t,e)=>{r.onsuccess=()=>t(r.result),r.onerror=()=>e(r.error)}));var r}));await Promise.all(s)}(t)}t&&(this.user=P(Math.floor(100*window.Math.random())))}async save(t){const e=U(t);try{const s=await this.dbService.read(I,e);return s?(t.avatar&&(s.avatar=t.avatar,await this.dbService.update(I,s,e)),this.user=s,s):(await this.dbService.create(I,t,e),this.user=t,t)}catch(t){return}}async updateUserAchievement(t,e,s){if(!this.user)return!1;if(t<this.user.score)return!1;this.user.score=t,this.user.time=e,this.user.cardsField=s,this.user.datetime=new Date;const i=U(this.user);try{await this.dbService.update(I,this.user,i)}catch(t){return!1}return!0}async getFirstByScore(t=5){let e=0;const s=[],i=this.dbService.openTransaction(I,"readonly");return i.objectStore(I).index(F.SCORE).openCursor(null,"prev").onsuccess=i=>{const a=i.target.result;a&&e<t&&(s.push(a.value),e+=1,a.continue())},new Promise((t=>{i.oncomplete=()=>t(s)}))}async logAll(){const t=this.dbService.openTransaction(I,"readonly");return t.objectStore(I).openCursor().onsuccess=t=>{t.target.result?.continue()},new Promise((e=>{t.oncomplete=()=>e(!0)}))}},B=new class{constructor(){this.jsonUrl=v}async fetch(){if(!this.cache){const t=await fetch(v),e=await t.json();this.cache=e.filter((t=>f.has(t.category))).reduce(((t,e)=>t.set(f.get(e.category),e.images)),new Map)}return this.cache}async generateUrls(t){const e=(await this.fetch()).get(t);if(e)return{front:Array.from({length:e.last-e.first},((s,i)=>`${t}/${String(i+e.first).padStart(e.leftPad,e.leftPadChar)}.${e.extension}`)),back:e.cardCover}}async getUrls(t,e){const s=await this.generateUrls(t);if(!s)return;let{front:i}=s;return i=w(i).slice(0,e/2),i=w(i.concat(i)),{front:i,back:s.back}}},$=new class{constructor(t,e){this.localStorage=new D("fronte-finem__match-match-game___game-settings",t,e)}load(){return this.localStorage.load()}save(t){return this.localStorage.save(t)}}(C,new class{constructor(){this.serialize=t=>JSON.stringify(t),this.deserialize=t=>{const e=JSON.parse(t),{rows:s,columns:i}=e.cardsField;return e.cardsField=new g(s,i),e}}}),G="cell--281AIDUN3",z={title:{tag:"h2",text:"How to play?",classNames:["title--1MNNjkMaC"]},step1:{text:"Register new player in game",userService:new class{constructor(){this.user=P(999)}get currentUser(){return this.user}save(t){return this.user=t,Promise.resolve(t)}updateUserAchievement(t,e,s){return this.user.score=t,this.user.time=e,this.user.cardsField=s,this.user.datetime=new Date,Promise.resolve(!0)}getFirstByScore(t=5){return Promise.resolve(Array(t).fill(this.user))}logAll(){return Promise.resolve(!!this.user)}}},step2:{text:"Configure your game settings"},step3:{cardFieldModel:new g(2,3),text:"Start you new game! Remember card positions and match it before times up.",gameSettingsService:$,cardImagesService:B}};class j{constructor({classNames:t=[],...e}){this.view=new h({...e,classNames:["page--1AFmu1ZbC",...t]})}}const q={text:"add user"},H={text:"cancel",classNames:["btn--invert"]},W={text:"OK"},Z="svg-icon--3UFqy2Alh",X={wrapper:{classNames:["input-wrapper--3K_3ttZz-"]},input:{tag:"input",classNames:["input--1o9v8hEJk"]},output:{classNames:["output--1Ijr_knh5"]},icons:{input:{url:"./svg/sprite.svg#icon-cross",classNames:[Z,"svg-icon--input--13kTZqRYd"]},output:{url:"./svg/sprite.svg#icon-avatar",classNames:[Z,"svg-icon--output--3fCflPSbC"]}}};class Y extends h{constructor({url:t,alt:e="image",classNames:s=[],...i}){super({...i,tag:"img",classNames:["img",...s]}),this.element.src=t,this.element.alt=e,this.element.setAttribute("crossOrigin","anonymous")}}function J(t){return new Promise((e=>{const s=new Y(t);s.element.addEventListener("load",(()=>e(s)))}))}class K extends h{constructor(){super({classNames:["avatar--1EphQ3_TI"]}),this.input=new h(X.input),this.output=new h(X.output),this.init()}getAvatar(){return this.imgBase64}init(){const t=c(X.icons.output);this.output.element.append(t),this.render([this.output,this.initInput()])}initInput(){const t=c(X.icons.input),e=new h(X.wrapper);return e.render(this.input),e.element.append(t),this.input.element.type="file",this.input.element.addEventListener("input",(()=>{this.handleAddAvatar()})),e}async handleAddAvatar(){const t=this.input.element.files;if(!t)return;const e=t[0];let s=await J({url:window.URL.createObjectURL(e)});const i=function(t,e){const s=document.createElement("canvas"),i=s.getContext("2d");if(!i)return"";const a=Math.min(t.width,t.height),r=(t.width-a)/2,n=(t.height-a)/2;return i.canvas.width=e,i.canvas.height=e,i.drawImage(t,r,n,a,a,0,0,e,e),s.toDataURL()}(s.element,200);i&&(this.imgBase64=i,s=await J({url:i}),this.output.render(s))}}const Q="hidden--2yEgepIqC",tt="pop-up__side--25PtkCbPW";class et extends h{constructor(t,e=[]){super({tag:"section",classNames:["pop-up--YriWNg8R0",Q,...e]}),this.header=new h({tag:"header",classNames:[tt,"pop-up__header--30ffs2ZuF"]}),this.footer=new h({tag:"footer",classNames:[tt,"pop-up__footer--l6g4pGxFS"]}),this.body=new h({classNames:["pop-up__body--2XaS7WQjB"]}),this.render([this.header,this.body,this.footer]),this.header.render(new h({tag:"h3",classNames:["pop-up__title--2k_Gkp0dd"],text:t})),this.onClick((t=>{t.cancelBubble=!0}))}addContent(t){this.body.render(t)}addButtons(t){this.footer.render(t)}async show(){await this.setCssStateAsync(Q,!1)}async hide(){await this.setCssStateAsync(Q,!0)}}const st={required:!0,errorMessage:"The name shouldn't contain only numbers and can't contain symbols: ~ ! @ # $ % * () _ — + = | : ; \" ' ` < > , . ? / ^",pattern:/^(?!\d+$)[^~!@#$%*()_—+=|:;"'`<>,.?/^]{1,30}$/,minLength:1,maxLength:30},it={firstnName:{title:"first name",type:"text",placeholder:"Jessie",validation:st},lastName:{title:"last name",type:"text",placeholder:"Doe",validation:st},email:{title:"e-mail",type:"email",placeholder:"Jessie.Doe@gmail.com",validation:{required:!0,errorMessage:"Email not valid 🙁",pattern:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,minLength:3,maxLength:30}}},at="error--xI8ai97nB",rt=" characters; you entered ";class nt extends h{constructor({title:t,type:e="text",placeholder:s="",validation:i,classNames:a=[],...r}){super({...r,classNames:["input-wrapper--MSRjq87Pw",...a]}),this.label=new h({tag:"label",classNames:["title--2k4UySCei"]}),this.input=new h({tag:"input",classNames:["input--1DPWoXDUZ"]});const{required:n,pattern:o,minLength:c,maxLength:l,errorMessage:u}=i;this.title=x(t),this.label.setText(this.title),this.errorMessage=u,this.input.element.type=e,this.input.element.placeholder=s,this.input.element.required=n,this.input.element.pattern=o.source,this.input.element.minLength=c,this.input.element.maxLength=l,this.render([this.label,this.input]),this.onInput((()=>this.validate())),this.onInvalid((t=>this.setError(t)))}validate(){return this.resetError(),this.input.element.reportValidity()}reset(){this.resetError(),this.input.element.value=""}resetError(){this.input.element.setCustomValidity(""),this.setCssStateAsync(at,!1)}setError(t){t.valueMissing?this.input.element.setCustomValidity(`${this.title} required`):t.patternMismatch?this.input.element.setCustomValidity(this.errorMessage):t.tooShort?this.input.element.setCustomValidity(`${this.title} should be at least ${this.input.element.minLength}${rt}${this.input.element.value.length}.`):t.tooLong&&this.input.element.setCustomValidity(`${this.title} should be less than ${this.input.element.maxLength}${rt}${this.input.element.value.length}.`),this.setCssStateAsync(at,!0)}onInput(t,e){this.input.element.addEventListener("input",(()=>t(this.input.element.value)),e)}onInvalid(t,e){this.input.element.addEventListener("invalid",(()=>t(this.input.element.validity)),e)}}const ot={"inputs-wrapper":"inputs-wrapper--FUqnkovkX",inputsWrapper:"inputs-wrapper--FUqnkovkX"};class ct extends h{constructor(){super({classNames:[ot.formWrapper]}),this.form=new h({tag:"form"}),this.inputFirstName=new nt(it.firstnName),this.inputLastName=new nt(it.lastName),this.inputEmail=new nt(it.email),this.init()}init(){const t=new h({classNames:[ot.inputsWrapper]});this.render(this.form),this.form.render(t),t.render(this.inputs)}get inputs(){return[this.inputFirstName,this.inputLastName,this.inputEmail]}validate(){return this.inputs.every((t=>t.validate()))}reset(){this.inputs.map((t=>t.reset()))}getValue(){return{firstName:this.inputFirstName.input.element.value,lastName:this.inputLastName.input.element.value,email:this.inputEmail.input.element.value}}}class ht extends h{constructor({classNames:t,...e}){super({...e,tag:"button",classNames:["btn"].concat(t||[])})}active(t=!0){this.setCssState("btn--active",t)}}class lt extends et{constructor(t){super("🦸‍♀️ Register new Player 🦸"),this.userService=t,this.form=new h({tag:"form"}),this.signUpView=new ct,this.avatarControl=new K,this.btnAddUser=new ht(q),this.btnCancel=new ht(H),this.init()}init(){const t=new h({classNames:["user-form--PhptjbZyg"]});t.render([this.signUpView,this.avatarControl]),this.addContent(t),this.addButtons([this.btnAddUser,this.btnCancel])}async task(){return new Promise((t=>{this.btnAddUser.onClick((async()=>this.onAddUser(t))),this.btnCancel.onClick((()=>{this.signUpView.reset(),t(!1)}))}))}async onAddUser(t){if(this.signUpView.validate()){const e=this.getUser();t(void 0!==await this.userService.save(e))}return!1}getUser(){return{...this.signUpView.getValue(),score:0,time:0,avatar:this.avatarControl.getAvatar()}}}const ut=(t,e=[])=>{const s=new h({classNames:["info--3mPND9DBQ",G,...e]}),i=new h({classNames:["text--2lH_KyQsC"],text:t});return s.render(i),s},dt=(t,e=[])=>{const s=new h({classNames:["pict--3_pLUPlU1",G,...e]});return s.render(t),s},mt=()=>{const t=new lt(z.step1.userService);return t.show(),[ut(z.step1.text,["info--step1--1nRRq6ata"]),dt(t,["pict--step1--3IRWPNldc"])]};var pt,gt,wt;!function(t){t.ABOUT="#/about-game",t.GAME="#/game",t.SETTINGS="#/game-settings",t.SCORE="#/best-score"}(pt||(pt={})),function(t){t.ABOUT="about-game",t.GAME="game",t.SETTINGS="game-settings",t.SCORE="best-score"}(gt||(gt={})),function(t){t.ABOUT="./svg/sprite.svg#icon-question-mark",t.SETTINGS="./svg/sprite.svg#icon-gear",t.SCORE="./svg/sprite.svg#icon-star"}(wt||(wt={}));class vt extends h{constructor(){super({tag:"nav",classNames:["nav-menu--oq7N5R5oz"]})}init(t){this.navLinks=t.filter((t=>void 0!==t.navSvgIcon)).reduce(((t,e)=>t.set(e.route.url,(({route:t,navSvgIcon:e=""})=>{const s=new l({url:t.url,classNames:["nav-link--3vlnkh93B"]});s.setText(t.title);const i={url:e,classNames:["svg-icon--2ZlcA-p-O"]};return s.element.append(c(i)),s})(e))),new Map),this.render((t=>{const e=new h({tag:"ul",classNames:["nav-items--ClElNpQa4"]});return e.render(t.map((t=>(t=>{const e=new h({tag:"li",classNames:["nav-item--tNzLKtmzy"]});return e.render(t),e})(t)))),e})([...this.navLinks.values()]))}setActiveNavLink(t){this.activeNavLink?.active(!1),this.activeNavLink=this.navLinks?.get(t),this.activeNavLink?.active()}}class St{constructor(){this.listenersMap=new Map}subscribe(t,e){this.listenersMap.has(t)||this.listenersMap.set(t,new Set),this.listenersMap.get(t)?.add(e)}unsubscribe(t,e){this.listenersMap.get(t)?.delete(e)}notify(t,e){this.listenersMap.get(t)?.forEach((t=>t(e)))}}class ft{constructor(t){this.observer=new St,this.state={},t&&this.init(t)}init(t){this.state=this.proxify(t)}getState(){return{...this.state}}onStateChange(t){this.observer.subscribe("state-change",t)}proxify(t){return new Proxy(t,{set:(t,e,s)=>(t[e]=s,this.observer.notify("state-change",this.getState()),this.observer.notify(e,s),!0)})}}class Nt extends ft{constructor(t,e,s,i){super({isError:!1,isMatch:!1,isFrontSide:!1,clickedCount:0,errorCount:0}),this.id=t,this.frontImage=e,this.backImage=s,this.mismatchShowTime=i}flip(t){this.state.isMatch||this.state.isError||(this.state.isFrontSide=t)}match(t){this.state.isMatch=t}async error(){var t;this.state.isMatch||(this.state.errorCount+=1,this.state.isError=!0,await(t=1e3*this.mismatchShowTime,new Promise((e=>setTimeout(e,t)))),this.state.isError=!1,this.flip(!1))}click(){this.state.isMatch||this.state.isError||this.state.isFrontSide||(this.flip(!0),this.state.clickedCount+=1)}}const Ct={title:{tag:"h2",classNames:["title--1SzCRlWoG"],getMessage:t=>`🤔 Page "${t}" — unknown! 🤔\r\n😱 It's 404 code, OMG! 😱`},card:new Nt(2,"cats/27.jpg","dogs/05.jpg",0)},yt="card__side--1YnFocLsV",bt=t=>`url("./images/${t}")`;class xt extends h{constructor(t){super({classNames:["card-container--i0yIuD8uN"]}),this.init(t)}init(t){const e=new h({classNames:[yt,"card__side--back--1vG-3cHdj"]}),s=new h({classNames:[yt,"card__side--front--1toEdlg30"]});e.setCssStyle("backgroundImage",bt(t.backImage)),s.setCssStyle("backgroundImage",bt(t.frontImage)),this.render(new h({classNames:["card--19lZCi7QM"],childs:[e,s]}))}async flip(t=!0){await this.setCssStateAsync("flipped--2EZsq6Spb",t)}error(t=!0){this.setCssState("error--3HGSMKD5U",t)}match(t=!0){this.setCssState("match--1yCHxpwpW",t)}}class Et extends j{constructor(){super({classNames:["page-error--azMzupOSh"]}),this.cardModel=Ct.card,this.cardView=new xt(this.cardModel)}stop(){this.view.clear()}init(t="#/unknown"){const e=new h(Ct.title);e.setText(Ct.title.getMessage(t.slice(2)));const s=new h({classNames:["wrapper--37IJ1Cjms"]});s.render(this.cardView),this.view.render([e,s]),this.initCard()}initCard(){this.cardView.onClick((async()=>{const t=!this.cardModel.getState().isFrontSide;this.cardModel.flip(t),await this.cardView.flip(t)}))}}const At=()=>{const t=new vt;return t.init([{route:{url:pt.SETTINGS,title:gt.SETTINGS,pageCreator:()=>new Et},navSvgIcon:wt.SETTINGS}]),t.setActiveNavLink(pt.SETTINGS),[ut(z.step2.text,["info--step2--3OXcBx_33"]),dt(t,["pict--step2--2c69X1HQl"])]};class Tt{constructor(t){this.model=t,this.view=new xt(t),this.model.onStateChange((t=>this.updateView(t)))}onClick(t){this.view.onClick((()=>t(this)))}async updateView(t){this.view.error(t.isError),this.view.match(t.isMatch),await this.view.flip(t.isFrontSide)}}class It{constructor(){this.view=new h({classNames:["cards-field--1SU6hNcue"]})}render(t,e){this.view.clear(),this.setRows(e.rows),this.setColumns(e.columns),this.view.render(t.map((t=>t.view)))}setColumns(t){this.view.setCssVar("--cards-columns",String(t))}setRows(t){this.view.setCssVar("--cards-rows",String(t))}}const Mt=async()=>{const t=new It,e=z.step3.gameSettingsService.load(),s=await z.step3.cardImagesService.getUrls(e.cardImagesCategory,z.step3.cardFieldModel.getCardsAmount());if(!s)throw new Error("Cards images urls generation failed");const i=s.front.map(((t,i)=>new Nt(i,t,s.back,e.mismatchShowTime))),a=i.map((t=>new Tt(t)));return function(t){const e=t[y(0,t.length-1)];t.filter((t=>t.frontImage===e.frontImage)).forEach((t=>{t.flip(!0),t.match(!0)}))}(i),t.render(a,z.step3.cardFieldModel),[ut(z.step3.text,["info--step3--1DY3lSDD7"]),dt(t.view,["pict--step3--1-sG2HRjL"])]};class Rt extends j{constructor(){super({classNames:["page-about--1ykuqFFGR"]})}async init(){const t=new h(z.title),e=new h({classNames:["grid--1hx-WsiMF"]});e.render([mt(),At(),await Mt()].flat()),this.view.render([t,e])}stop(){this.view.clear()}}function kt(t){const e=t%60;return[e,(t-e)/60]}function Lt(t){const[e,s]=kt(Math.floor(t)),[i,a]=kt(s);return{hours:a,min:i,sec:e,diff:t}}function Ft(t){const{hours:e,min:s,sec:i}=Lt(t);return{hours:String(e).padStart(2,"0"),min:String(s).padStart(2,"0"),sec:String(i).padStart(2,"0"),diff:t}}class Vt extends ft{constructor(){super({startTime:0,currentTime:0})}reset(t=0){window.clearInterval(this.timerId),this.state.startTime=0,this.state.currentTime=t}stop(){return window.clearInterval(this.timerId),this.diff}start(t=0){this.reset(t),this.timerId=window.setInterval((()=>this.increment()),1e3)}async countdown(t=10){return new Promise((e=>{this.reset(t),this.timerId=window.setInterval((()=>{this.decrement(),this.state.currentTime>0||(this.reset(),e())}),1e3)}))}increment(){this.state.currentTime+=1}decrement(){this.state.currentTime-=1}get diff(){return this.state.currentTime-this.state.startTime}}const Ut="timer__output--2TxoOB91B",Pt=(t=":")=>new h({classNames:[Ut,"timer__output--splitter--3RPQD9d0b"],text:t});class Dt extends h{constructor(){super({classNames:["timer--3hmDgpm1E"]}),this.output={seconds:new h({classNames:[Ut,"timer__output--seconds--m2fBlsDJB"]}),minutes:new h({classNames:[Ut,"timer__output--minutes--1dMtRHovH"]}),hours:new h({classNames:[Ut,"timer__output--hours--11f_qoGHw"]})},this.init()}init(t=":"){const e=new h({classNames:["timer__box--22sYiA39u"]});e.render([this.output.hours,Pt(t),this.output.minutes,Pt(t),this.output.seconds]),this.render(e)}show(t){this.output.seconds.element.textContent=t.sec,this.output.minutes.element.textContent=t.min,t.hours&&(this.output.hours.element.textContent=t.hours)}stop(t=!0){this.setCssState("timer--stop--3hJx4Xln3",t)}countdown(t=!0){this.setCssState("timer--countdown--1I-_ImbQN",t)}reset(){this.stop(!1),this.countdown(!1)}}class Ot{constructor(){this.view=new Dt,this.model=new Vt,this.updateView(this.model.getState()),this.model.onStateChange((t=>this.updateView(t)))}updateView(t){this.view.show(Ft(t.currentTime-t.startTime))}start(){this.view.reset(),this.model.start()}stop(){this.model.stop(),this.view.stop()}reset(){this.model.reset(),this.view.reset()}async countdown(t=10){this.view.countdown(),await this.model.countdown(t)}}const _t=N.cardsField.map((t=>t.getCardsAmount())).sort()[0],Bt=[...N.initialShowTime].sort(((t,e)=>e-t))[0],$t=[...N.mismatchShowTime].sort(((t,e)=>e-t))[0];function Gt(t){const{cardsField:e,initialShowTime:s,mismatchShowTime:i}=t;return e.getCardsAmount()/_t*.25*(Bt/s)+$t/i*.1}var zt;!function(t){t.SOLVED="game-solved",t.ERROR="game-error"}(zt||(zt={}));class jt extends ft{constructor(t){super({isError:!1,isStopped:!0,isSolved:!1,gameActiveCard:void 0,matchedCards:new Set}),this.cards=t,this.gameObserver=new St,this.cards=t}flipAll(t){this.cards.forEach((e=>e.flip(t)))}onSolved(t){this.gameObserver.subscribe(zt.SOLVED,t)}showAllCards(){this.flipAll(!0)}start(){this.flipAll(!1),this.state.isStopped=!1}stop(){this.state.isStopped=!0}get activeCard(){return this.state.gameActiveCard}async cardClickHandler(t){return!(this.state.isStopped||this.state.isError||this.state.matchedCards.has(t)||t===this.state.gameActiveCard||(t.click(),this.state.gameActiveCard?(this.match(t)||await this.error(t),0):(this.state.gameActiveCard=t,0)))}match(t){return t.frontImage===this.state.gameActiveCard?.frontImage&&(this.state.gameActiveCard.match(!0),t.match(!0),this.state.matchedCards.add(this.state.gameActiveCard),this.state.matchedCards.add(t),this.state.gameActiveCard=void 0,this.state.matchedCards.size===this.cards.length&&(this.state.isSolved=!0,this.stop(),this.gameObserver.notify(zt.SOLVED,this.state)),!0)}async error(t){this.state.isError=!0,await Promise.all([this.state.gameActiveCard?.error(),t.error()]),this.state.isError=!1,this.state.gameActiveCard=void 0}get clicks(){const[t,e]=this.cards.reduce((([t,e],s)=>{const{clickedCount:i,errorCount:a}=s.getState();return[t+i,e+a]}),[0,0]);return{all:t,error:e}}getMatches(){const{all:t,error:e}=this.clicks;return[t/2,e/2]}}const qt="game--solved--2M0U5Nryc";class Ht extends j{constructor(t,e,s,i){super({classNames:["game--3_WFWXfxo"]}),this.appStateService=t,this.gameSettingsService=e,this.cardImagesService=s,this.userService=i,this.timer=new Ot,this.cardsField=new It,this.cards=[],this.view.render([this.timer.view,this.cardsField.view])}init(){this.newGame()}stop(){this.stopGame()}stopGame(){this.timer.reset(),this.model?.stop(),this.model=void 0,this.cards=[],this.cardsField.view.clear(),this.view.setCssState(qt,!1)}async newGame(){this.stopGame();const t=this.gameSettingsService.load(),e=await this.initCards(t);this.model=new jt(e),this.model.showAllCards(),await this.timer.countdown(t.initialShowTime),this.model.start(),this.timer.start(),this.model.onSolved((()=>this.succesEndGame(t)))}async initCards(t){const e=await this.cardImagesService.getUrls(t.cardImagesCategory,t.cardsField.getCardsAmount());if(!e)throw new Error("Cards images urls generation failed");const s=e.front.map(((s,i)=>new Nt(i,s,e.back,t.mismatchShowTime)));return this.cards=s.map((t=>new Tt(t))),this.cards.forEach((t=>t.onClick((()=>this.cardClickHandler(t))))),this.cardsField.render(this.cards,t.cardsField),s}succesEndGame(t){if(this.timer.stop(),this.view.setCssState(qt,!0),!this.model)return;const e=function([t,e],s,i){const a=100*(Gt(i)*(t-e)-e)-10*s;return a<0?0:a}(this.model.getMatches(),this.timer.model.diff,t);this.userService.updateUserAchievement(e,this.timer.model.diff,t.cardsField.toString()),this.appStateService.requestStateChange({from:V.GAME,to:V.SOLVED})}async cardClickHandler(t){return!!this.model&&this.model.cardClickHandler(t.model)}}const Wt={title:{tag:"h2",classNames:["title--Blb2qCdBd"],text:"Select images preset\r\n🎴🃏"},selector:new Map([[S.DOGS,new Nt(1,"dogs/05.jpg","covers/dog.svg",0)],[S.CATS,new Nt(2,"cats/27.jpg","covers/cat.svg",0)]])};class Zt extends h{constructor(){super({classNames:["cards--1yggexp6h"]}),this.cards=new Map([...Wt.selector.entries()].map((([t,e])=>[t,new xt(e)])));const t=new h(Wt.title);this.render([t,this.initSelector()])}initSelector(){const t=new h({classNames:["wrapper--3z29Ktpb4"]});return t.render([...this.cards.values()]),t}initControls(t){const e=t.getState();this.activeCard=this.cards.get(e.cardImagesCategory),this.activeCard?.match(!0),this.activeCard?.flip(!0),[...this.cards.entries()].forEach((([e,s])=>s.onClick((async()=>{s!==this.activeCard&&(t.state.cardImagesCategory=e,this.activeCard?.match(!1),s.match(!0),this.activeCard?.error(!0),await s.flip(!0),this.activeCard?.error(!1),this.activeCard?.flip(!1),this.activeCard=s)}))))}}const Xt="range--NorPPKzSf",Yt={title:{tag:"h2",classNames:["title--2L5rwRJbS"],text:"Adjust difficulty you want\r\n🥱😌🥴🤪🤯"},cardsRange:{title:"🎴🎴 Cards field (rows × columns)",classNames:[Xt],values:N.cardsField},initialShowTimeRange:{title:"⏱🃏 Start game countdown (seconds)",classNames:[Xt],values:N.initialShowTime},mismatchShowTimeRange:{title:"🍎🍏 Delay flip after mismatch (seconds)",classNames:[Xt],values:N.mismatchShowTime},scoreModifier:{classNames:["score-modifier--1FpbFWcMJ"]},scoreTitle:{tag:"h3",classNames:["score-title--zhVvwJB9i"],text:"Score modifier\r\n💎 × 🏆"}},Jt={"select-container":"select-container--2qMqk-kXI",selectContainer:"select-container--2qMqk-kXI",title:"title--x7oz--0Nc",selector:"selector--2mb9FNFi6",option:"option--3JZjhnarx"};class Kt extends h{constructor(t){super({...t,tag:"option",classNames:[Jt.option].concat(t.classNames||[])}),this.value=t.value,this.init(t)}init({value:t,selected:e,disabled:s,title:i}){this.element.setAttribute("value",t),e&&(this.element.selected=!0),s&&(this.element.disabled=!0),i&&(this.element.title=i)}selected(t=!0){this.element.selected=t}}class Qt extends h{constructor({classNames:t=[],...e}){super({...e,classNames:[...t,"input-range--3-38_wovx"]}),this.getId=()=>(Qt.id+=1,`input-range-view-${Qt.id}`),this.values=[],this.title=new h({tag:"label",classNames:["title--3KBNYFkh9"]}),this.input=new h({tag:"input",classNames:["input--IzORuehw7"]}),this.output=new h({tag:"output",classNames:["output--1hdOnRGJi"]}),this.datalist=new h({tag:"datalist",classNames:["datalist--1kKDoeGQ2"]}),this.init(e)}init({title:t,values:e,value:s}){this.title.setText(t),this.initValues(e),this.initInput(s),this.initDatalist(),this.initOutput(),this.render([this.title,new h({classNames:["wrapper--3sznUBODj"]}).render([this.input,this.datalist]),this.output])}initValues(t){this.values=t}initInput(t){this.input.element.type="range",this.input.element.min=String(0),this.input.element.max=String(this.values.length-1),this.input.element.step=String(1),this.setInputValue(t)}initDatalist(){this.datalist.element.id=this.getId(),this.input.element.setAttribute("list",this.datalist.element.id),this.datalist.render(this.values.map(((t,e)=>new Kt({value:String(e),classNames:["option--3Aoq3UH0j"]}))))}initOutput(){this.setOutputValue(),this.onSelect((t=>{this.output.element.value=t.toString()}))}onSelect(t){this.input.element.addEventListener("input",(()=>t(this.getValue())))}getValue(){const t=Number(this.input.element.value);return this.values[t]}setValue(t){this.setInputValue(t),this.setOutputValue()}setInputValue(t){let e;t?(e="string"==typeof t||"number"==typeof t?this.values.indexOf(t):this.values.map((e=>e.equal(t))).indexOf(!0),this.input.element.value=e<0?"0":String(e)):this.input.element.value="0"}setOutputValue(){this.output.element.value=this.getValue().toString()}}Qt.id=0;class te extends h{constructor(){super({classNames:["difficulty--1v1pVpw6Y"]}),this.cardsRange=new Qt(Yt.cardsRange),this.initialShowTimeRange=new Qt(Yt.initialShowTimeRange),this.mismatchShowTimeRange=new Qt(Yt.mismatchShowTimeRange),this.scoreModifier=new h(Yt.scoreModifier),this.init()}init(){const t=new h(Yt.title),e=new h({classNames:["wrapper--3X8rIt7Dz"]});e.render([this.initInputs(),this.initOutputs()]),this.render([t,e])}initInputs(){const t=new h({classNames:["inputs--HChPKwG71"]});return t.render([this.cardsRange,this.initialShowTimeRange,this.mismatchShowTimeRange]),t}initOutputs(){const t=new h({classNames:["outputs--3J10knlWl"]}),e=new h(Yt.scoreTitle);return t.render([e,this.scoreModifier]),t}initControls(t){const e=t.getState();this.cardsRange.setValue(e.cardsField),this.initialShowTimeRange.setValue(e.initialShowTime),this.mismatchShowTimeRange.setValue(e.mismatchShowTime),this.scoreModifier.setText(Gt(e).toFixed(2)),this.cardsRange.onSelect((e=>{t.state.cardsField=e,this.scoreModifier.setText(Gt(t.state).toFixed(2))})),this.initialShowTimeRange.onSelect((e=>{t.state.initialShowTime=e,this.scoreModifier.setText(Gt(t.state).toFixed(2))})),this.mismatchShowTimeRange.onSelect((e=>{t.state.mismatchShowTime=e,this.scoreModifier.setText(Gt(t.state).toFixed(2))}))}}class ee extends ft{}const se="cell--2be5-70wY";class ie extends j{constructor(t){super({classNames:["settings--C-VaPZFRX"]}),this.gameSettingsService=t,this.model=new ee,this.settingsCards=new Zt,this.settingsDifficulty=new te}stop(){this.view.clear()}init(){const t=new h({classNames:["settings-wrapper--2pEsVn9hO"]});this.view.render(t),t.render([this.initSettingsCards(),this.initDifficultyCustomizer()]),this.initModel()}initModel(){const t=this.gameSettingsService.load();this.model.init({...t}),this.model.onStateChange((t=>this.gameSettingsService.save(t))),this.initControls()}initSettingsCards(){const t=new h({classNames:[se,"cell--1--2SvX1YmLB"]});return t.render(this.settingsCards),t}initDifficultyCustomizer(){const t=new h({classNames:[se,"cell--2--1pTOSourS"]});return t.render(this.settingsDifficulty),t}initControls(){this.settingsCards.initControls(this.model),this.settingsDifficulty.initControls(this.model)}}function ae(t,e,s,i){t.avatar?e.render(new Y({url:t.avatar,classNames:i})):e.element.append(c({url:"./svg/sprite.svg#icon-avatar",classNames:s}))}const re="side--xr4JAwDPu",ne="user--2v1ZM5j6L",oe="avatar__img--39shtDkVb",ce="unknown";class he extends h{constructor(t){super({classNames:["record--1H7GIP-JF"]}),this.user=t,this.init()}init(){const t=new h({classNames:["card--3zJ4HDDin"]});t.render([this.initFront(),this.initBack()]),this.render(t)}initFront(){const t=new h({classNames:[re,"front--2ahNbUgMr"]}),e=new h({classNames:["avatar--1aNBjkzaB"]}),s=new h({classNames:[ne,"name--2xfuKm3vr"]}),i=new h({classNames:[ne,"mail--2rLudgXx5"]}),a=new h({classNames:["score--2bdm8XqyD"]});this.initAvatar(e);const{firstName:r,lastName:n,email:o,score:c}=this.user;return this.element.title=((t,e,s,i)=>`Firstname: ${t}\nLastname: ${e}\nEmail: ${s}\nScore: ${i}`)(r,n,o,c),s.setText(`${r} ${n}`),i.setText(o),a.setText(String(c)),t.render([e,s,i,a]),t}initBack(){const t=this.user.datetime?.toLocaleString()||ce,e=this.user.cardsField||ce,{hours:s,min:i,sec:a}=Ft(this.user.time||0);return new h(`<div class="side--xr4JAwDPu back--1nyZDzWAr">\n      <div class="title--nYtsntcyL">Record date:</div>\n      <div class="datetime--SDNVYhnbe">${t}</div>\n      <div class="title--nYtsntcyL">Cards field:</div>\n      <div class="cardsField--2BNXnxFIU">${e}</div>\n      <div class="title--nYtsntcyL">>Game win time:</div>\n      <div class="time--35-IaAz9L">${s}:${i}:${a}</div>\n    </div>`)}initAvatar(t){ae(this.user,t,["svg-icon--v-bsxO5s8",oe],[oe])}getUser(){return this.user}highlight(t=!0){this.setCssState("highlight--2Ce_EWrwX",t)}}const le="set--32HqVZeAW";class ue extends j{constructor(t){super({classNames:["page-score--2uhR0AVk0"]}),this.userService=t}stop(){this.view.clear()}async init(){const t=(await this.userService.getFirstByScore(10)).map((t=>new he(t))),{currentUser:e}=this.userService;if(e){const s=U(e),i=t=>s===U(t.getUser()),a=t.filter(i);a.length>0&&a[0].highlight()}this.initRows(t)}initRows(t){const e=new h({classNames:["users--3iyj5LTJa"]}),s=new h({classNames:[le,"set-1--1MJHwXlKK"]}),i=new h({classNames:[le,"set-2--vXv0hPTWA"]}),a=new h({classNames:[le,"set-3--1mSblqsno"]}),r=new h({classNames:[le,"set-4--mE2z9-UBs"]});s.render(t.slice(0,1)),i.render(t.slice(1,3)),a.render(t.slice(3,6)),r.render(t.slice(6,10)),e.render([s,i,a,r]),this.view.render(e)}}const de={route:{url:pt.ABOUT,title:gt.ABOUT,pageCreator:()=>new Rt},navSvgIcon:wt.ABOUT},me={route:{url:pt.GAME,title:gt.GAME,pageCreator:()=>new Ht(O,$,B,_)}},pe={route:{url:pt.SETTINGS,title:gt.SETTINGS,pageCreator:()=>new ie($)},navSvgIcon:wt.SETTINGS},ge={route:{url:pt.SCORE,title:gt.SCORE,pageCreator:()=>new ue(_)},navSvgIcon:wt.SCORE},we=m({initialRoute:de.route,pages:{about:de,score:ge,settings:pe,game:me}}),ve="text--1IXorsDyp",Se="match";class fe extends l{constructor(){super({url:we.initialRoute.url,classNames:["logo--1pHuFgWu9"]}),this.init()}init(){const t=new h({classNames:[ve,"text--1--2YmOoHsf3"]}),e=new h({classNames:[ve,"text--2--1W13Ff_EC"]});t.setText(Se),e.setText(Se),this.render([t,e])}}class Ne{constructor(t){this.initialState=t,this.statesMap=new Map,this.currentState=t,this.addState(t)}addState(t){return this.statesMap.set(t.name,t),this}getCurrentState(){return this.currentState}applyCurrentState(t){this.currentState.apply(t)}nextState(t,e=!0){const s=this.currentState,i=this.statesMap.get(s.next)||this.initialState;this.currentState=i,this.applyCurrentState(t),e&&t.observer.notify(s.name,[s.name,i.name])}}class Ce{constructor(t,e,s,i){this.name=t,this.next=e,this.btnText=s,this.hideAvatar=i}apply(t){t.setBtnText(this.btnText),t.hideAvatar(this.hideAvatar)}}const ye={header:"header--1NncKmEQQ",wrapper:"wrapper--3rfyi-BeM","btn-state-switch":"btn-state-switch--1kI9X1ZWl",btnStateSwitch:"btn-state-switch--1kI9X1ZWl","btn--hidden":"btn--hidden--1cPXNsYdt",btnHidden:"btn--hidden--1cPXNsYdt",avatar:"avatar--1ZdwmxlvE","avatar--hidden":"avatar--hidden--16fndReds",avatarHidden:"avatar--hidden--16fndReds",avatar__img:"avatar__img--3hk5gpfiG",avatarImg:"avatar__img--3hk5gpfiG","svg-icon":"svg-icon--3aPTFVWrY",svgIcon:"svg-icon--3aPTFVWrY"};class be extends h{constructor(t,e){super({tag:"header",classNames:[ye.header]}),this.appStateService=t,this.userService=e,this.observer=new St,this.stateMaсhine=new Ne(new Ce(V.INITIAL,V.READY,p.btns.signUp.text,!0)).addState(new Ce(V.READY,V.GAME,p.btns.start.text,!1)).addState(new Ce(V.GAME,V.READY,p.btns.stop.text,!1)),this.menu=new vt,this.avatar=new h({classNames:[ye.avatar]}),this.btnStateSwitch=new ht({classNames:[ye.btn,ye.btnStateSwitch]}),this.init(),this.initStateSwitcher(),this.stateMaсhine.applyCurrentState(this)}init(){this.render(new h({classNames:[ye.wrapper],childs:[new fe,this.menu,this.btnStateSwitch,this.avatar]}))}initStateSwitcher(){this.btnStateSwitch.onClick((async()=>{const t=this.stateMaсhine.getCurrentState();await this.appStateService.requestStateChange({from:t.name,to:t.next})&&this.stateMaсhine.nextState(this)}))}nextState(){this.stateMaсhine.nextState(this,!1)}hideAvatar(t=!0){if(this.avatar.setCssState(ye.avatarHidden,t),!t&&""===this.avatar.element.innerHTML){const t=this.userService.currentUser;if(!t)return;ae(t,this.avatar,[ye.svgIcon,ye.avatarImg],[ye.avatarImg])}}setBtnText(t){this.btnStateSwitch.setText(t)}}const xe="hidden--3NyI22jWd",Ee="root--modal-mode--24Uf6g9cD";class Ae extends h{constructor(){super({classNames:["modal-cover--2OW8-d3HV",xe]})}async show(){await this.setCssStateAsync(xe,!1),document.body.classList.add(Ee)}async hide(){await this.setCssStateAsync(xe,!0),document.body.classList.remove(Ee)}}class Te extends et{constructor(t,e=NaN){super("🏆 Victory! 🏆"),this.userService=t,this.btnConfirn=new ht(W),this.init(e,this.userService.currentUser)}init(t,e){e&&(this.addContent(new h(function(t){if(!t.time)return"";const{hours:e,min:s,sec:i}=Lt(t.time);let a=[`${e} hours`,`${s} minutes`,`${i} seconds`];return a=t.time>3600?a:a.slice(1),a=t.time>60?a:a.slice(1),`<div class="output--PLzdIITwP">Congratulations, <span class="highlight--18WQ-Hrv7">${t.firstName} ${t.lastName}</span>!<br>You successfully found all matches in time<span class="highlight--18WQ-Hrv7">${a.join(" ")}</span><br>with score  <span class="highlight--18WQ-Hrv7">${t.score}</span>.</div>`}(e))),this.addButtons(this.btnConfirn))}task(){return new Promise((t=>{this.btnConfirn.onClick((()=>t(!0)))}))}}class Ie{constructor(){this.listeners=new Set}subscribe(t){this.listeners.add(t)}unsubscribe(t){this.listeners.delete(t)}notify(t){this.listeners.forEach((e=>e(t)))}}const Me={url:"#/⛔",title:"Page Not Found!",pageCreator:()=>new Et};class Re{constructor(){this.observer=new Ie,this.routes=new Map,this.errorPageRoute=Me,this.currentUrl="",window.addEventListener("hashchange",(()=>this.observer.notify(this.updateCurrentRoute())))}onChange(t){this.observer.subscribe(t)}addRoute(t){return this.routes.set(t.url,t),this}getPageRoute(t){return this.routes.get(t)||this.errorPageRoute}updateCurrentRoute(){const t=this.currentUrl,e=Re.getCurrentUrl();return t===e&&this.currentPage||this.updateRoute(e),{oldUrl:t,newUrl:e,newPage:this.currentPage}}updateRoute(t){const e=this.getPageRoute(t);return document.title=`🎴 Match-Match 🃏 ${x(e.title)} 🎴`,this.currentPage?.stop(),this.currentPage=e.pageCreator(),this.currentPage.init(t),this.currentUrl=t,this.currentPage}static getCurrentUrl(){return window.location.hash||""}static activateRoute(t){window.location.hash=t}static resetHash(){window.history.replaceState(null,document.title,".")}}class ke{constructor(t){this.view=new h({tag:"main",classNames:["app--2_KmwgIsG"]}),this.headerView=new be(O,_),this.pageContainer=new h({classNames:["page-container--2BzkQwOZo"]}),this.modalView=new Ae,this.router=new Re,this.gameStoppedByButton=!1,this.initApp(),t.append(this.view.element)}initApp(){O.init((t=>this.handleAppStateChangeRequest(t))),this.initRouter(),this.initHeader();const t=new d;this.view.render([this.headerView,this.pageContainer,t,this.modalView])}initHeader(){this.headerView.menu.init(Object.values(we.pages))}initRouter(){Object.values(we.pages).forEach((t=>this.router.addRoute(t.route))),this.router.onChange((t=>this.applayRouteChange(t)))}async start(){Re.resetHash(),Re.activateRoute(we.initialRoute.url),this.headerView.menu.setActiveNavLink(we.initialRoute.url),await _.init()}applayRouteChange({oldUrl:t,newUrl:e,newPage:s}){e!==we.pages.game.route.url||_.currentUser?(t===we.pages.game.route.url&&_.currentUser&&!this.gameStoppedByButton&&this.headerView.nextState(),s&&this.pageContainer.render(s.view),this.headerView.menu.setActiveNavLink(e)):Re.activateRoute(we.initialRoute.url)}async handleAppStateChangeRequest(t){let e;switch(t.from){case V.INITIAL:return e=await this.processPopUp(new lt(_)),e;case V.READY:return this.gameStoppedByButton=!1,Re.activateRoute(we.pages.game.route.url),!0;case V.GAME:return t.to===V.READY?Re.getCurrentUrl()===we.pages.game.route.url&&(this.gameStoppedByButton=!0,Re.activateRoute(we.initialRoute.url)):t.to===V.SOLVED&&(await this.processPopUp(new Te(_)),Re.activateRoute(we.pages.score.route.url)),!0;case V.SOLVED:return!0;default:return!1}}async processPopUp(t){await this.showPopup(t);const e=await t.task();return await this.hidePopup(t),e}async showPopup(t){this.modalView.render(t),this.modalView.onClick((async()=>this.hidePopup(t))),await this.modalView.show(),await t.show()}async hidePopup(t){await Promise.all([t.hide(),this.modalView.hide()])}}window.addEventListener("load",(()=>{document.body.classList.add("root"),new ke(document.body).start()}))})();