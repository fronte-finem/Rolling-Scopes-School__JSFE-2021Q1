(()=>{"use strict";var t;!function(t){t.INITIAL="initial",t.READY="ready",t.GAME="game",t.SOLVED="solved"}(t||(t={}));const e={btns:{signUp:{text:"register new player"},start:{text:"start game"},stop:{text:"stop game"}}};function s(t){const e=t;for(let t=e.length-1;t>0;t-=1){const s=Math.floor((t+1)*Math.random());[e[s],e[t]]=[e[t],e[s]]}return e}const a="./images.json";var i;!function(t){t.CATS="cats",t.DOGS="dogs"}(i||(i={}));const r=new Map(Object.values(i).map((t=>[t,t]))),n=new Map([[i.CATS,"üê± Cats üêàüêà‚Äç‚¨õ"],[i.DOGS,"üê∂ Dogs üêïüê©üêï‚Äçü¶∫"]]);class o{constructor(t,e){this.rows=t,this.columns=e}getCardsAmount(){return this.rows*this.columns}toString(){return`${this.rows} √ó ${this.columns}`}equal(t){return t.rows===this.rows&&t.columns===this.columns}}class c{constructor(){this.serialize=t=>JSON.stringify(t),this.deserialize=t=>{const e=JSON.parse(t),{rows:s,columns:a}=e.cardsField;return e.cardsField=new o(s,a),e}}}class h{constructor(t,e,s){this.storageKey=t,this.initialSettings=e,this.serializer=s}loadSettings(){const t=window.localStorage.getItem(this.storageKey);return t?this.serializer.deserialize(t):this.initialSettings}saveSettings(t){window.localStorage.setItem(this.storageKey,this.serializer.serialize(t))}}function l(t){return`${t[0].toUpperCase()}${t.slice(1).toLowerCase()}`}function u(t){return t.split(" ").map(l).join(" ")}const d=()=>new Error("‚ö†Ô∏è Database not opened, created, linked ‚ö†Ô∏è");class m{constructor(t,e=1){this.dbName=t,this.dbVersion=e}open(t=1){this.dbVersion=t;const e=window.indexedDB.open(this.dbName,this.dbVersion);return new Promise(((t,s)=>{e.onupgradeneeded=()=>this.onOpen(e.result,t,!0),e.onsuccess=()=>this.onOpen(e.result,t,!1),e.onerror=()=>s(new Error("‚ö†Ô∏è Can't open DB. Probably browser user didn't allow this web app to use IndexedDB? ‚ö†Ô∏è"))}))}onOpen(t,e,s=!1){this.db=t,e({db:t,upgradeMode:s})}openTransaction(t,e){if(!this.db)throw d();return this.db.transaction(t,e)}openStore(t,e){if(!this.db)throw d();return this.db.transaction(t,e).objectStore(t)}static asyncRequest(t){return new Promise(((e,s)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>s(t.error)}))}operate(t,e,s,a){const i=e(this.openStore(t,a));return new Promise(((t,e)=>{i.onsuccess=()=>t(i.result),i.onerror=()=>e(this.errorGenerator(s))}))}create(t,e,s){return this.operate(t,(t=>t.add(e,s)),{operation:"Create",key:s,storeName:t},"readwrite")}read(t,e){return this.operate(t,(t=>t.get(e)),{operation:"Read",key:e,storeName:t},"readonly")}update(t,e,s){return this.operate(t,(t=>t.put(e,s)),{operation:"Update",key:s,storeName:t},"readwrite")}delete(t,e){return this.operate(t,(t=>t.delete(e)),{operation:"Delete",key:e,storeName:t},"readwrite")}errorGenerator({operation:t,storeName:e,key:s}){return new Error(`‚ö†Ô∏èDB::${this.dbName}.${this.dbVersion}: <${t}> on store "${e}" failed for key "${String(s)}" ‚ö†Ô∏è`)}}const p="users";class g{constructor(){this.dbService=new m("fronte-finem",1)}get currentUser(){return this.user}async init(t=!1){const{db:e,upgradeMode:s}=await this.dbService.open();if(s){const t=g.createStore(e);await g.addTestUsers(t)}t&&(this.user=g.createTestUser(Math.floor(100*window.Math.random())))}static createStore(t){const e=t.createObjectStore(p);return e.createIndex("firstName","firstName",{unique:!1}),e.createIndex("lastName","lastName",{unique:!1}),e.createIndex("email","email",{unique:!1}),e.createIndex("score","score",{unique:!1}),e.createIndex("fullId",["firstName","lastName","email"],{unique:!0}),e}static async addTestUsers(t,e=100){const s=Array.from({length:e}).map(((e,s)=>{const a=g.createTestUser(s),i=g.userHashCode(a),r=t.add(a,i);return m.asyncRequest(r)}));await Promise.all(s)}static createTestUser(t){return{firstName:"Test",lastName:`User${t}`,email:`test.user${t}@${t}resu.tset`,score:t/10,time:Math.abs(5e3-40*t)}}async save(t){const e=g.userHashCode(t),s=await this.dbService.read(p,e);if(s)return this.user=s,s;try{await this.dbService.create(p,t,e)}catch(t){return}return this.user=t,t}static userHashCode({firstName:t,lastName:e,email:s}){return function(t){let e=0;for(let s=0;s<t.length;s+=1)e=Math.imul(31,e)+t.charCodeAt(s);return 0|e}(JSON.stringify({firstName:t,lastName:e,email:s}))}async updateUserAchievement(t,e){if(!this.user)return!1;if(t<this.user.score)return!1;this.user.score=t,this.user.time=e;const s=g.userHashCode(this.user);try{await this.dbService.update(p,this.user,s)}catch(t){return!1}return!0}async getFirstByScore(t=5){let e=0;const s=[],a=this.dbService.openTransaction(p,"readonly");return a.objectStore(p).index("score").openCursor(null,"prev").onsuccess=a=>{const i=a.target.result;i&&e<t&&(s.push(i.value),e+=1,i.continue())},new Promise((t=>{a.oncomplete=()=>t(s)}))}async logAll(){const t=this.dbService.openTransaction(p,"readonly");return t.objectStore(p).openCursor().onsuccess=t=>{t.target.result?.continue()},new Promise((e=>{t.oncomplete=()=>e(!0)}))}}const v=[new o(4,3),new o(4,4),new o(5,4),new o(6,4),new o(6,5),new o(6,6),new o(7,6),new o(8,6),new o(8,7),new o(8,8)],w=Array.from({length:6},((t,e)=>5*(e+1))),S=Array.from({length:5},((t,e)=>e+1)),b={settings:{cardImagesCategory:i.DOGS,cardsField:v[5],initialShowTime:w[1],mismatchShowTime:S[2]}},f=new class{init(t){this.requestListener=t}requestStateChange(t){return this.requestListener(t)}},C=new g,y=new class{constructor(){this.jsonUrl=a}async fetch(){if(!this.cache){const t=await fetch(a),e=await t.json();this.cache=e.filter((t=>r.has(t.category))).reduce(((t,e)=>t.set(r.get(e.category),e.images)),new Map)}return this.cache}async generateUrls(t){const e=(await this.fetch()).get(t);if(e)return{front:Array.from({length:e.last-e.first},((s,a)=>`${t}/${String(a+e.first).padStart(e.leftPad,e.leftPadChar)}.${e.extension}`)),back:e.cardCover}}async getUrls(t,e){const a=await this.generateUrls(t);if(!a)return;let{front:i}=a;return i=s(i).slice(0,e/2),i=s(i.concat(i)),{front:i,back:a.back}}},N=new class{constructor(t){this.initialSettings=t,this.localStorage=new h("fronte-finem__match-match-game___game-settings",this.initialSettings,new c)}loadSettings(){return this.localStorage.loadSettings()}saveSettings(t){return this.localStorage.saveSettings(t)}}(b.settings),A="http://www.w3.org/2000/svg";function x(t,e){const s=document.createElementNS(A,"svg"),a=document.createElementNS(A,"use");return a.setAttribute("href",t),s.append(a),s.classList.add("svg-icon"),Array.isArray(e)&&s.classList.add(...e),s}class I{constructor(t){if("string"==typeof t)this.element=function(t){const e=document.createElement("template");return e.innerHTML=t,e.content.firstElementChild}(t);else{const{childs:e,hookElement:s,...a}=t;this.element=function({tag:t="div",classNames:e,text:s}){const a=document.createElement(t);return Array.isArray(e)&&a.classList.add(...e),s&&(a.textContent=s),a}(a),e&&this.render(e),s&&s(this.element)}}static getElemet(t){return t instanceof I?t.element:t}getText(){return this.element.textContent}setText(t){this.element.textContent=t}clear(){return this.element.innerHTML="",this}render(t){return this.clear(),Array.isArray(t)?this.element.append(...t.map((t=>t.element))):this.element.append(t.element),this}setCssState(t,e=!0){this.element.classList.toggle(t,e)}setCssStateAsync(t,e=!0){return this.element.classList.toggle(t,e),new Promise((t=>{this.element.addEventListener("transitionend",(()=>t()),{once:!0})}))}setCssStyle(t,e){this.element.style[t]=e}getCssVar(t){return function(t,e){return getComputedStyle(t).getPropertyValue(e)}(this.element,t)}setCssVar(t,e){!function(t,e,s){t.style.setProperty(e,s)}(this.element,t,e)}onClick(t,e){this.element.addEventListener("click",t,e)}}class _ extends I{constructor({classNames:t,...e}){super({...e,tag:"button",classNames:["btn"].concat(t||[])})}active(t=!0){this.setCssState("btn--active",t)}}class k extends I{constructor({url:t,classNames:e,...s}){super({...s,tag:"a",classNames:["link"].concat(e||[])}),this.element.href=t}active(t=!0){this.setCssState("link--active",t)}}class E extends I{constructor({url:t,alt:e="image",classNames:s,...a}){super({...a,tag:"img",classNames:["img"].concat(s||[])}),this.element.src=t,this.element.alt=e,this.element.setAttribute("crossOrigin","anonymous")}static create(t){return new Promise((e=>{const s=new E(t);s.element.addEventListener("load",(()=>e(s)))}))}}class T{static view({tag:t,build:e,hookView:s,...a}){let i;switch(t){case"a":i=new k(a);break;case"img":i=new E(a);break;case"button":i=new _(a);break;default:i=new I({tag:t,...a})}if(s&&s(i),e)if(Array.isArray(e)){const t=e.map((t=>T.view(t)));i.render(t)}else i.render(T.view(e));return i}}class L{constructor({classNames:t=[],...e}){this.view=T.view({classNames:["page--1AFmu1ZbC",...t],...e})}}class V extends L{constructor(){super({classNames:["page-about"]})}init(){this.view.render(new I({tag:"h1",text:V.name}))}stop(){this.view.clear()}}const R="card__side--1YnFocLsV",M=(t,e)=>t.setCssStyle("backgroundImage",(t=>`url("./images/${t}")`)(e));class U extends I{constructor(t){super({classNames:["card-container--i0yIuD8uN"]});const e=new I({classNames:[R,"card__side--back--1vG-3cHdj"]}),s=new I({classNames:[R,"card__side--front--1toEdlg30"]});M(e,t.backImage),M(s,t.frontImage),this.render(new I({classNames:["card--19lZCi7QM"],childs:[e,s]}))}async flip(t=!0){await this.setCssStateAsync("flipped--2EZsq6Spb",t)}error(t=!0){this.setCssState("error--3HGSMKD5U",t)}match(t=!0){this.setCssState("match--1yCHxpwpW",t)}}class P{constructor(t){this.model=t,this.view=new U(t),this.model.onStateChange((t=>this.updateView(t)))}onClick(t){this.view.onClick((()=>t(this)))}async updateView(t){this.view.error(t.isError),this.view.match(t.isMatch),await this.view.flip(t.isFrontSide)}}class O{constructor(){this.view=new I({classNames:["cards-field--1SU6hNcue"]})}render(t,e){this.view.clear(),this.setRows(e.rows),this.setColumns(e.columns),this.view.render(t.map((t=>t.view)))}setColumns(t){this.view.setCssVar("--cards-columns",String(t))}setRows(t){this.view.setCssVar("--cards-rows",String(t))}}class B{constructor(){this.listenersMap=new Map}subscribe(t,e){this.listenersMap.has(t)||this.listenersMap.set(t,new Set),this.listenersMap.get(t)?.add(e)}unsubscribe(t,e){this.listenersMap.get(t)?.delete(e)}notify(t,e){this.listenersMap.get(t)?.forEach((t=>t(e)))}}class ${constructor(t){this.observer=new B,this.state={},t&&this.init(t)}init(t){this.state=this.proxify(t)}getState(){return{...this.state}}onStateChange(t){this.observer.subscribe("state-change",t)}proxify(t){return new Proxy(t,{set:(t,e,s)=>(t[e]=s,this.observer.notify("state-change",this.getState()),this.observer.notify(e,s),!0)})}static logChangeState(t,e,s){return`Changin ${String(t)} property ${e} from ${String(t[e])} to ${String(s)}`}}class D extends ${constructor(t){super({isError:!1,isStopped:!0,isSolved:!1,gameActiveCard:void 0,matchedCards:new Set}),this.cards=t,this.gameObserver=new B,this.cards=t}flipAll(t){this.cards.forEach((e=>e.flip(t)))}onSolved(t){this.gameObserver.subscribe("game-solved",t)}showAllCards(){this.flipAll(!0)}start(){this.flipAll(!1),this.state.isStopped=!1}stop(){this.state.isStopped=!0}get activeCard(){return this.state.gameActiveCard}async cardClickHandler(t){return!(this.state.isStopped||this.state.isError||this.state.matchedCards.has(t)||t===this.state.gameActiveCard||(t.click(),this.state.gameActiveCard?(this.match(t)||await this.error(t),0):(this.state.gameActiveCard=t,0)))}match(t){return t.frontImage===this.state.gameActiveCard?.frontImage&&(this.state.gameActiveCard.match(!0),t.match(!0),this.state.matchedCards.add(this.state.gameActiveCard),this.state.matchedCards.add(t),this.state.gameActiveCard=void 0,this.state.matchedCards.size===this.cards.length&&(this.state.isSolved=!0,this.stop(),this.gameObserver.notify("game-solved",this.state)),!0)}async error(t){this.state.isError=!0,await Promise.all([this.state.gameActiveCard?.error(),t.error()]),this.state.isError=!1,this.state.gameActiveCard=void 0}get clicks(){const[t,e]=this.cards.reduce((([t,e],s)=>{const{clickedCount:a,errorCount:i}=s.getState();return[t+a,e+i]}),[0,0]);return{all:t,error:e}}getMatches(){const{all:t,error:e}=this.clicks;return[t/2,e/2]}}class F extends ${constructor(t,e,s,a){super({isError:!1,isMatch:!1,isFrontSide:!1,clickedCount:0,errorCount:0}),this.id=t,this.frontImage=e,this.backImage=s,this.mismatchShowTime=a}flip(t){this.state.isMatch||this.state.isError||(this.state.isFrontSide=t)}match(t){this.state.isMatch=t}async error(){var t;this.state.isMatch||(this.state.errorCount+=1,this.state.isError=!0,await(t=1e3*this.mismatchShowTime,new Promise((e=>setTimeout(e,t)))),this.state.isError=!1,this.flip(!1))}click(){this.state.isMatch||this.state.isError||this.state.isFrontSide||(this.flip(!0),this.state.clickedCount+=1)}}function q(t){const e=t%60;return[e,(t-e)/60]}function G(t){const[e,s]=q(Math.floor(t)),[a,i]=q(s);return{hours:i,min:a,sec:e,diff:t}}function H(t){const{hours:e,min:s,sec:a}=G(t);return{hours:String(e).padStart(2,"0"),min:String(s).padStart(2,"0"),sec:String(a).padStart(2,"0"),diff:t}}class j extends ${constructor(){super({startTime:0,currentTime:0})}reset(t=0){window.clearInterval(this.timerId),this.state.startTime=0,this.state.currentTime=t}stop(){return window.clearInterval(this.timerId),this.diff}start(t=0){this.reset(t),this.timerId=window.setInterval((()=>this.increment()),1e3)}async countdown(t=10){return new Promise((e=>{this.reset(t),this.timerId=window.setInterval((()=>{this.decrement(),this.state.currentTime>0||(this.reset(),e())}),1e3)}))}increment(){this.state.currentTime+=1}decrement(){this.state.currentTime-=1}get diff(){return this.state.currentTime-this.state.startTime}}const z="timer__output--2TxoOB91B";class W extends I{constructor(t=":"){super({classNames:["timer--3hmDgpm1E"]}),this.output={seconds:new I({classNames:[z,"timer__output--seconds--m2fBlsDJB"]}),minutes:new I({classNames:[z,"timer__output--minutes--1dMtRHovH"]}),hours:new I({classNames:[z,"timer__output--hours--11f_qoGHw"]})},this.render(new I({classNames:["timer__box--22sYiA39u"],childs:[this.output.hours,W.createSplitter(t),this.output.minutes,W.createSplitter(t),this.output.seconds]}))}show(t){this.output.seconds.element.textContent=t.sec,this.output.minutes.element.textContent=t.min,t.hours&&(this.output.hours.element.textContent=t.hours)}static createSplitter(t=":"){return new I({classNames:[z,"timer__output--splitter--3RPQD9d0b"],text:t})}stop(t=!0){this.setCssState("timer--stop--3hJx4Xln3",t)}countdown(t=!0){this.setCssState("timer--countdown--1I-_ImbQN",t)}reset(){this.stop(!1),this.countdown(!1)}}class Z{constructor(){this.view=new W,this.model=new j,this.updateView(this.model.getState()),this.model.onStateChange((t=>this.updateView(t)))}updateView(t){this.view.show(H(t.currentTime-t.startTime))}start(){this.view.reset(),this.model.start()}stop(){this.model.stop(),this.view.stop()}reset(){this.model.reset(),this.view.reset()}async countdown(t=10){this.view.countdown(),await this.model.countdown(t)}}const Y="game--solved--2M0U5Nryc";class K extends L{constructor(t,e,s,a){super({classNames:["game--3_WFWXfxo"]}),this.appStateService=t,this.gameSettingsService=e,this.cardImagesService=s,this.userService=a,this.timer=new Z,this.cardsField=new O,this.cards=[],this.view.render([this.timer.view,this.cardsField.view])}init(){this.newGame()}stop(){this.stopGame()}stopGame(){this.timer.reset(),this.model?.stop(),this.model=void 0,this.cards=[],this.cardsField.view.clear(),this.view.setCssState(Y,!1)}async newGame(){this.stopGame();const t=this.gameSettingsService.loadSettings(),e=await this.initCards(t);this.model=new D(e),this.model.showAllCards(),await this.timer.countdown(t.initialShowTime),this.model.start(),this.timer.start(),this.model.onSolved((()=>this.succesEndGame()))}async initCards(t){const e=await this.cardImagesService.getUrls(t.cardImagesCategory,t.cardsField.getCardsAmount());if(!e)throw new Error("Cards images urls generation failed");const s=e.front.map(((s,a)=>new F(a,s,e.back,t.mismatchShowTime)));return this.cards=s.map((t=>new P(t))),this.cards.forEach((t=>t.onClick((()=>this.cardClickHandler(t))))),this.cardsField.render(this.cards,t.cardsField),s}succesEndGame(){if(this.timer.stop(),this.view.setCssState(Y,!0),!this.model)return;const e=function([t,e],s){const a=100*(t-e-e)-10*s;return a<0?0:a}(this.model.getMatches(),this.timer.model.diff);this.userService.updateUserAchievement(e,this.timer.model.diff),this.appStateService.requestStateChange({from:t.GAME,to:t.SOLVED})}async cardClickHandler(t){return!!this.model&&this.model.cardClickHandler(t.model)}}const X={"select-container":"select-container--2qMqk-kXI",selectContainer:"select-container--2qMqk-kXI","select-label":"select-label--3OgUUngdK",selectLabel:"select-label--3OgUUngdK",selector:"selector--2mb9FNFi6",option:"option--3JZjhnarx"};class J extends I{constructor(t){super({...t,tag:"option",classNames:[X.option].concat(t.classNames||[])}),this.value=t.value,this.init(t)}init({value:t,selected:e,disabled:s,title:a}){this.element.setAttribute("value",t),e&&(this.element.selected=!0),s&&(this.element.disabled=!0),a&&(this.element.title=a)}}class Q extends I{constructor({classNames:t=[],...e}){super({...e,classNames:[...t,X.selectContainer]}),this.optionsMap=new Map,this.label=new I({tag:"label",classNames:[X.selectLabel]}),this.select=new I({tag:"select",classNames:[X.selector]}),this.placeholder=new J({value:"placeholder",text:"placeholder",selected:!0,disabled:!0}),this.init(e)}init({heading:t,placeholder:e}){this.render([this.label,this.select]),this.label.setText(t),this.placeholder.setText(e),this.select.element.add(this.placeholder.element)}addOptions(t){return t.forEach((t=>{const e=new J(t);this.optionsMap.set(e.element.value,e),this.select.element.add(e.element)})),this}onSelect(t,e){const s=this.select.element;s.addEventListener("input",(()=>t(this.optionsMap.get(s.value)?.value)),e)}}class tt extends ${}const et={settings:"settings--C-VaPZFRX","settings-wrapper":"settings-wrapper--2pEsVn9hO",settingsWrapper:"settings-wrapper--2pEsVn9hO",settings__select:"settings__select--BAwgzNiED",settingsSelect:"settings__select--BAwgzNiED"};class st extends I{constructor({classNames:t=[],...e}){super({...e,classNames:[...t,"input-range--3-38_wovx"]}),this.getId=()=>(st.id+=1,`input-range-view-${st.id}`),this.values=[],this.title=new I({tag:"label",classNames:["title--3KBNYFkh9"]}),this.input=new I({tag:"input",classNames:["input--IzORuehw7"]}),this.output=new I({tag:"output",classNames:["output--1hdOnRGJi"]}),this.datalist=new I({tag:"datalist",classNames:["datalist--1kKDoeGQ2"]}),this.init(e)}init({title:t,values:e,value:s}){this.title.setText(t),this.initValues(e),this.initInput(s),this.initDatalist(),this.initOutput(),this.render([this.title,new I({classNames:["wrapper--3sznUBODj"]}).render([this.input,this.datalist]),this.output])}initValues(t){this.values=t}initInput(t){this.input.element.type="range",this.input.element.min=String(0),this.input.element.max=String(this.values.length-1),this.input.element.step=String(1),this.setInputValue(t)}initDatalist(){this.datalist.element.id=this.getId(),this.input.element.setAttribute("list",this.datalist.element.id),this.datalist.render(this.values.map(((t,e)=>new J({value:String(e),classNames:["option--3Aoq3UH0j"]}))))}initOutput(){this.setOutputValue(),this.onSelect((t=>{this.output.element.value=t.toString()}))}onSelect(t){this.input.element.addEventListener("input",(()=>t(this.getValue())))}getValue(){const t=Number(this.input.element.value);return this.values[t]}setValue(t){this.setInputValue(t),this.setOutputValue()}setInputValue(t){let e;t?(e="string"==typeof t||"number"==typeof t?this.values.indexOf(t):this.values.map((e=>e.equal(t))).indexOf(!0),this.input.element.value=e<0?"0":String(e)):this.input.element.value="0"}setOutputValue(){this.output.element.value=this.getValue().toString()}}st.id=0;class at extends L{constructor(t){super({classNames:[et.settings]}),this.gameSettingsService=t,this.model=new tt,this.selectGameCards=new Q({heading:"game cards",placeholder:"Select game cards type",classNames:[et.settingsSelect]}),this.cardsRange=new st({title:"üé¥üé¥ Cards field (rows √ó columns)",values:v,classNames:[et.range]}),this.initialShowTimeRange=new st({title:"‚è±üÉè Start game countdown (seconds)",values:w,classNames:[et.range]}),this.mismatchShowTimeRange=new st({title:"üçéüçè Delay flip after mismatch (seconds)",values:S,classNames:[et.range]}),this.wrapper=new I({classNames:[et.settingsWrapper]})}stop(){this.view.clear()}init(){this.view.render(this.wrapper),this.wrapper.render([this.selectGameCards,this.cardsRange,this.initialShowTimeRange,this.mismatchShowTimeRange]);const t=this.gameSettingsService.loadSettings();this.model.init(t),this.model.onStateChange((t=>this.gameSettingsService.saveSettings(t))),this.initSelectsors(this.model.getState()),this.initRanges(this.model.getState())}initRanges(t){this.cardsRange.setValue(t.cardsField),this.initialShowTimeRange.setValue(t.initialShowTime),this.mismatchShowTimeRange.setValue(t.mismatchShowTime),this.cardsRange.onSelect((t=>{this.model.state.cardsField=t})),this.initialShowTimeRange.onSelect((t=>{this.model.state.initialShowTime=t})),this.mismatchShowTimeRange.onSelect((t=>{this.model.state.mismatchShowTime=t}))}initSelectsors(t){this.selectGameCards.addOptions(at.prepareCategoryOptions(t)),this.selectGameCards.onSelect((t=>{this.model.state.cardImagesCategory=t}))}static prepareCategoryOptions(t){return Object.values(i).map((e=>({value:e,text:n.get(e),selected:t.cardImagesCategory===e})))}}function it(t,e,s,a){t.avatar?e.render(new E({url:t.avatar,classNames:a})):e.element.append(x("./svg/sprite.svg#icon-avatar",s))}const rt={"page-score":"page-score--2uhR0AVk0",pageScore:"page-score--2uhR0AVk0",row:"row--1sSguwB__",title:"title--2Ff5fFSCV",title__users:"title__users--2e1rOItHh",titleUsers:"title__users--2e1rOItHh",title__score:"title__score--YqqzK2y1d",titleScore:"title__score--YqqzK2y1d",title__time:"title__time--5cLi7Su3F",titleTime:"title__time--5cLi7Su3F",users:"users--3iyj5LTJa",item:"item--2hhu0vVki","item--current-user":"item--current-user--3eXm2nhYt",itemCurrentUser:"item--current-user--3eXm2nhYt",user:"user--2fIx2m1ZH",user__name:"user__name--3ohc71kjU",userName:"user__name--3ohc71kjU",user__mail:"user__mail--3mSBrZ5F3",userMail:"user__mail--3mSBrZ5F3",score:"score--3OVRyhCla",time:"time--38mP2BWDO",avatar:"avatar--hI32UCRJX","avatar--hidden":"avatar--hidden--2VS4YhqBl",avatarHidden:"avatar--hidden--2VS4YhqBl",avatar__img:"avatar__img--2oblGDaSZ",avatarImg:"avatar__img--2oblGDaSZ","svg-icon":"svg-icon--1d1Msgc8S",svgIcon:"svg-icon--1d1Msgc8S"},nt="Best players",ot="Score",ct="Time";class ht extends L{constructor(t){super({classNames:[rt.pageScore]}),this.userService=t,this.records=new I({tag:"ul",classNames:[rt.users]})}stop(){this.view.clear()}async init(){const t=await this.userService.getFirstByScore(10),{currentUser:e}=this.userService;let s;if(e){const t=g.userHashCode(e);s=e=>t===g.userHashCode(e)}else s=()=>!1;const a=t.map((t=>ht.createRecord(t,s)));this.view.render([ht.initTitle(),this.records.render(a)])}static initTitle(){return new I({classNames:[rt.title,rt.row],childs:[[nt,[rt.cell1,rt.titleUsers]],[ot,[rt.cell2,rt.titleScore]],[ct,[rt.cell3,rt.titleTime]]].map((t=>ht.createTitle(...t)))})}static createTitle(t,e){return new I({tag:"h2",classNames:[rt.titlePart,...e],text:t})}static createRecord(t,e){const s=[rt.item,rt.row];e(t)&&s.push(rt.itemCurrentUser);const a=new I({tag:"li",classNames:s}),i=new I({classNames:[rt.avatar]});it(t,i,[rt.svgIcon,rt.avatarImg],[rt.avatarImg]);const r=new I({classNames:[rt.userName],text:`${t.firstName} ${t.lastName}`}),n=new I({classNames:[rt.userMail],text:`${t.email}`}),o=new I({classNames:[rt.cell1,rt.user]}),c=new I({classNames:[rt.cell2,rt.score],text:`${t.score}`}),h=H(t.time),l=new I({classNames:[rt.cell3,rt.time],text:`${h.hours}:${h.min}:${h.sec}`});return a.render([i,o.render([r,n]),c,l]),a}}class lt extends L{constructor(){super({classNames:["page-error"]})}init(){this.view.render(new I({tag:"h1",text:lt.name}))}stop(){this.view.clear()}}const ut={route:{url:"#/about-game",title:"about game",pageCreator:()=>new V},navSvgIcon:"./svg/sprite.svg#icon-question-mark"},dt={required:!0,errorMessage:"The name shouldn't contain only numbers and can't contain symbols: ~ ! @ # $ % * () _ ‚Äî + = | : ; \" ' ` < > , . ? / ^",pattern:/^(?!\d+$)[^~!@#$%*()_‚Äî+=|:;"'`<>,.?/^]{1,30}$/,minLength:1,maxLength:30},mt={title:"ü¶∏‚Äç‚ôÄÔ∏è Registr new Player ü¶∏",btns:{addUser:{text:"add user"},cancel:{text:"cancel"}},inputs:{firstnName:{title:"first name",type:"text",placeholder:"Jessie",validation:dt},lastName:{title:"last name",type:"text",placeholder:"Doe",validation:dt},email:{title:"e-mail",type:"email",placeholder:"Jessie.Doe@gmail.com",validation:{required:!0,errorMessage:"Email not valid üôÅ",pattern:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,minLength:3,maxLength:30}}}},pt={confirm:{text:"OK"}},gt={initialRoute:ut.route,header:e,pages:{about:ut,score:{route:{url:"#/best-score",title:"best score",pageCreator:()=>new ht(C)},navSvgIcon:"./svg/sprite.svg#icon-star"},settings:{route:{url:"#/game-settings",title:"game settings",pageCreator:()=>new at(N)},navSvgIcon:"./svg/sprite.svg#icon-gear"},game:{route:{url:"#/game",title:"about game",pageCreator:()=>new K(f,N,y,C)}}},popups:{signUp:mt}};class vt{constructor(){this.listeners=new Set}subscribe(t){this.listeners.add(t)}unsubscribe(t){this.listeners.delete(t)}notify(t){this.listeners.forEach((e=>e(t)))}}const wt={url:"#/‚õî",title:"Page Not Found!",pageCreator:()=>new lt};class St{constructor(){this.observer=new vt,this.routes=new Map,this.errorPageRoute=wt,this.currentUrl="",window.addEventListener("hashchange",(()=>this.observer.notify(this.updateCurrentRoute())))}onChange(t){this.observer.subscribe(t)}addRoute(t){return this.routes.set(t.url,t),this}getPageRoute(t){return this.routes.get(t)||this.errorPageRoute}updateCurrentRoute(){const t=this.currentUrl,e=St.getCurrentUrl();if(t!==e){const t=this.getPageRoute(e);u(t.title),this.currentPage?.stop(),this.currentPage=t.pageCreator(),this.currentPage.init(),this.currentUrl=e}return{oldUrl:t,newUrl:e,newPage:this.currentPage}}static getCurrentUrl(){return window.location.hash||""}static activateRoute(t){window.location.hash=t}}const bt={header:"header--1NncKmEQQ",wrapper:"wrapper--3rfyi-BeM",logo:"logo--3qnSiQFY3","btn-state-switch":"btn-state-switch--1kI9X1ZWl",btnStateSwitch:"btn-state-switch--1kI9X1ZWl","btn--hidden":"btn--hidden--1cPXNsYdt",btnHidden:"btn--hidden--1cPXNsYdt",avatar:"avatar--1ZdwmxlvE","avatar--hidden":"avatar--hidden--16fndReds",avatarHidden:"avatar--hidden--16fndReds",avatar__img:"avatar__img--3hk5gpfiG",avatarImg:"avatar__img--3hk5gpfiG","svg-icon":"svg-icon--3aPTFVWrY",svgIcon:"svg-icon--3aPTFVWrY"};class ft{constructor(t,e,s,a){this.name=t,this.next=e,this.btnText=s,this.hideAvatar=a}apply(t){t.setBtnText(this.btnText),t.hideAvatar(this.hideAvatar)}}class Ct extends I{constructor(){super({tag:"nav",classNames:["nav-menu--oq7N5R5oz"]}),this.navList=new I({tag:"ul",classNames:["nav-items--ClElNpQa4"]}),this.render(this.navList)}addNavLinks(t){this.navLinks=t.filter((t=>void 0!==t.navSvgIcon)).reduce(((t,e)=>t.set(e.route.url,Ct.createNavLink(e))),new Map),this.navList.render(Ct.createNavItems([...this.navLinks.values()]))}setActiveNavLink(t){this.activeNavLink?.active(!1),this.activeNavLink=this.navLinks?.get(t),this.activeNavLink?.active()}static createNavItems(t){return t.map((t=>new I({tag:"li",classNames:["nav-item--tNzLKtmzy"],childs:[t]})))}static createNavLink({route:t,navSvgIcon:e}){return new k({url:t.url,classNames:["nav-link--3vlnkh93B"],text:t.title,hookElement:t=>(e&&t.append(x(e,["svg-icon--2ZlcA-p-O"])),t)})}}class yt{constructor(t){this.initialState=t,this.statesMap=new Map,this.currentState=t,this.addState(t)}addState(t){return this.statesMap.set(t.name,t),this}getCurrentState(){return this.currentState}applyCurrentState(t){this.currentState.apply(t)}nextState(t,e=!0){const s=this.currentState,a=this.statesMap.get(s.next)||this.initialState;this.currentState=a,this.applyCurrentState(t),e&&t.observer.notify(s.name,[s.name,a.name])}}class Nt extends I{constructor(s,a){super({tag:"header",classNames:[bt.header]}),this.appStateService=s,this.userService=a,this.observer=new B,this.stateMa—Åhine=new yt(new ft(t.INITIAL,t.READY,e.btns.signUp.text,!0)).addState(new ft(t.READY,t.GAME,e.btns.start.text,!1)).addState(new ft(t.GAME,t.READY,e.btns.stop.text,!1)),this.logo=new k({url:gt.initialRoute.url,classNames:[bt.logo]}),this.menu=new Ct,this.avatar=new I({classNames:[bt.avatar]}),this.btnStateSwitch=new _({classNames:[bt.btn,bt.btnStateSwitch]}),this.init(),this.initStateSwitcher(),this.stateMa—Åhine.applyCurrentState(this)}init(){this.render(new I({classNames:[bt.wrapper],childs:[this.logo,this.menu,this.btnStateSwitch,this.avatar]}))}initStateSwitcher(){this.btnStateSwitch.onClick((async()=>{const t=this.stateMa—Åhine.getCurrentState();await this.appStateService.requestStateChange({from:t.name,to:t.next})&&this.stateMa—Åhine.nextState(this)}))}nextState(){this.stateMa—Åhine.nextState(this,!1)}hideAvatar(t=!0){if(this.avatar.setCssState(bt.avatarHidden,t),!t&&""===this.avatar.element.innerHTML){const t=this.userService.currentUser;if(!t)return;it(t,this.avatar,[bt.svgIcon,bt.avatarImg],[bt.avatarImg])}}setBtnText(t){this.btnStateSwitch.setText(t)}}const At="hidden--3NyI22jWd",xt="root--modal-mode--24Uf6g9cD";class It extends I{constructor(){super({classNames:["modal-cover--2OW8-d3HV",At]})}async show(){await this.setCssStateAsync(At,!1),document.body.classList.add(xt)}async hide(){await this.setCssStateAsync(At,!0),document.body.classList.remove(xt)}}const _t={"user-form":"user-form--PhptjbZyg",userForm:"user-form--PhptjbZyg","inputs-wrapper":"inputs-wrapper--372nhcpJe",inputsWrapper:"inputs-wrapper--372nhcpJe",avatar:"avatar--1YI9qA5PV",avatar__output:"avatar__output--fuOywBXJU",avatarOutput:"avatar__output--fuOywBXJU","btn-add-avatar-wrapper":"btn-add-avatar-wrapper--1XEfQ5sPK",btnAddAvatarWrapper:"btn-add-avatar-wrapper--1XEfQ5sPK","btn-add-avatar":"btn-add-avatar--3hR4Bk1aY",btnAddAvatar:"btn-add-avatar--3hR4Bk1aY","svg-icon":"svg-icon--17PWVtxbn",svgIcon:"svg-icon--17PWVtxbn","svg-icon--avatar-output":"svg-icon--avatar-output--3TBi_Xvh-",svgIconAvatarOutput:"svg-icon--avatar-output--3TBi_Xvh-","svg-icon--btn-add-avatar":"svg-icon--btn-add-avatar--1KvTQKuIJ",svgIconBtnAddAvatar:"svg-icon--btn-add-avatar--1KvTQKuIJ"},kt="hidden--2yEgepIqC",Et="pop-up__side--25PtkCbPW";class Tt extends I{constructor(t){super({tag:"section",classNames:["pop-up--YriWNg8R0",kt]}),this.header=new I({tag:"header",classNames:[Et,"pop-up__header--30ffs2ZuF"]}),this.footer=new I({tag:"footer",classNames:[Et,"pop-up__footer--l6g4pGxFS"]}),this.body=new I({classNames:["pop-up__body--2XaS7WQjB"]}),this.render([this.header,this.body,this.footer]),this.header.render(new I({tag:"h3",classNames:["pop-up__title--2k_Gkp0dd"],text:t})),this.onClick((t=>{t.cancelBubble=!0}))}addContent(t){this.body.render(t)}addButtons(t){this.footer.render(t)}async show(){await this.setCssStateAsync(kt,!1)}async hide(){await this.setCssStateAsync(kt,!0)}}const Lt="error--xI8ai97nB";class Vt extends I{constructor({title:t,type:e="text",placeholder:s="",validation:a,classNames:i=[],...r}){super({...r,classNames:["input-wrapper--MSRjq87Pw",...i]}),this.label=new I({tag:"label",classNames:["title--2k4UySCei"]}),this.input=new I({tag:"input",classNames:["input--1DPWoXDUZ"]});const{required:n,pattern:o,minLength:c,maxLength:h,errorMessage:l}=a;this.title=u(t),this.label.setText(this.title),this.errorMessage=l,this.input.element.type=e,this.input.element.placeholder=s,this.input.element.required=n,this.input.element.pattern=o.source,this.input.element.minLength=c,this.input.element.maxLength=h,this.render([this.label,this.input]),this.onInput((()=>this.validate())),this.onInvalid((t=>this.setError(t)))}validate(){return this.resetError(),this.input.element.reportValidity()}reset(){this.resetError(),this.input.element.value=""}resetError(){this.input.element.setCustomValidity(""),this.setCssStateAsync(Lt,!1)}setError(t){t.valueMissing?this.input.element.setCustomValidity(`${this.title} required`):t.patternMismatch?this.input.element.setCustomValidity(this.errorMessage):t.tooShort?this.input.element.setCustomValidity(`${this.title} should be at least ${this.input.element.minLength} characters; you entered ${this.input.element.value.length}.`):t.tooLong&&this.input.element.setCustomValidity(`${this.title} should be less than ${this.input.element.maxLength} characters; you entered ${this.input.element.value.length}.`),this.setCssStateAsync(Lt,!0)}onInput(t,e){this.input.element.addEventListener("input",(()=>t(this.input.element.value)),e)}onInvalid(t,e){this.input.element.addEventListener("invalid",(()=>t(this.input.element.validity)),e)}}const Rt=t=>new Vt(mt.inputs[t]),Mt=(t,...e)=>new _({...mt.btns[t],classNames:e});class Ut extends Tt{constructor(t){super(mt.title),this.userService=t,this.form=new I({tag:"form"}),this.inputFirstName=Rt("firstnName"),this.inputLastName=Rt("lastName"),this.inputEmail=Rt("email"),this.btnAddUser=Mt("addUser"),this.btnCancel=Mt("cancel","btn--invert"),this.btnAddAvatar=new I({tag:"input",classNames:[_t.btnAddAvatar]}),this.avatarOutput=new I({classNames:[_t.avatarOutput]}),this.addContent(new I({classNames:[_t.userForm]}).render([this.initInputs(),this.initAvatar()])),this.addButtons([this.btnAddUser,this.btnCancel])}initInputs(){return new I({classNames:[_t.formWrapper]}).render(this.form.render(new I({classNames:[_t.inputsWrapper]}).render(this.inputs)))}initAvatar(){return this.avatarOutput.element.append(x("./svg/sprite.svg#icon-avatar",[_t.svgIcon,_t.svgIconAvatarOutput])),new I({classNames:[_t.avatar]}).render([this.avatarOutput,this.initBtnAddAvatar()])}initBtnAddAvatar(){this.btnAddAvatar.element.type="file";const t=new I({classNames:[_t.btnAddAvatarWrapper]}).render(this.btnAddAvatar);return t.element.append(x("./svg/sprite.svg#icon-cross",[_t.svgIcon,_t.svgIconBtnAddAvatar])),this.btnAddAvatar.element.addEventListener("input",(()=>{this.handleAddAvatar()})),t}async handleAddAvatar(){const t=this.btnAddAvatar.element.files;if(!t)return;const e=t[0];let s=await E.create({url:window.URL.createObjectURL(e)});const a=function(t,e){const s=document.createElement("canvas"),a=s.getContext("2d");if(!a)return"";const i=Math.min(t.width,t.height),r=(t.width-i)/2,n=(t.height-i)/2;return a.canvas.width=e,a.canvas.height=e,a.drawImage(t,r,n,i,i,0,0,e,e),s.toDataURL()}(s.element,200);a&&(this.userAvatarBase64=a,s=await E.create({url:a}),this.avatarOutput.render(s))}get inputs(){return[this.inputFirstName,this.inputLastName,this.inputEmail]}async task(){return new Promise((t=>{this.btnAddUser.onClick((async()=>this.onAddUser(t))),this.btnCancel.onClick((()=>{this.resetInputs(),t(!1)}))}))}async onAddUser(t){if(this.isUserValid()){const e=this.getUser();t(void 0!==await this.userService.save(e))}return!1}isUserValid(){return this.inputs.every((t=>t.validate()))}resetInputs(){this.inputs.map((t=>t.reset()))}getUser(){return{firstName:this.inputFirstName.input.element.value,lastName:this.inputLastName.input.element.value,email:this.inputEmail.input.element.value,score:0,time:0,avatar:this.userAvatarBase64}}}class Pt extends Tt{constructor(t,e=NaN){super("üèÜ Victory! üèÜ"),this.userService=t,this.btnConfirn=new _({...pt.confirm,classNames:[]}),this.init(e,this.userService.currentUser)}init(t,e){e&&(this.addContent((t=>{const{hours:e,min:s,sec:a}=G(t.time);let i=[`${e} hours`,`${s} minutes`,`${a} seconds`];return i=t.time>3600?i:i.slice(1),i=t.time>60?i:i.slice(1),new I(`<div class="output--PLzdIITwP">Congratulations,\n    <span class="highlight--18WQ-Hrv7">${t.firstName} ${t.lastName}</span>!\n    <br>You successfully found all matches in time\n    <span class="highlight--18WQ-Hrv7">${i.join(" ")}</span>\n    <br>with score <span class="highlight--18WQ-Hrv7">${t.score}</span>.</div>`)})(e)),this.addButtons(this.btnConfirn))}task(){return new Promise((t=>{this.btnConfirn.onClick((()=>t(!0)))}))}}class Ot{constructor(t){this.view=new I({tag:"main",classNames:["app--2_KmwgIsG"]}),this.headerView=new Nt(f,C),this.pageContainer=new I({classNames:["page-container--2BzkQwOZo"]}),this.modalView=new It,this.router=new St,this.gameStoppedByButton=!1,this.initApp(),t.append(this.view.element)}initApp(){f.init((t=>this.handleAppStateChangeRequest(t))),this.initRouter(),this.initHeader(),this.view.render([this.headerView,this.pageContainer,this.modalView])}initHeader(){this.headerView.menu.addNavLinks(Object.values(gt.pages))}initRouter(){Object.values(gt.pages).forEach((t=>this.router.addRoute(t.route))),this.router.onChange((t=>this.applayRouteChange(t)))}async start(){St.activateRoute(gt.initialRoute.url),this.headerView.menu.setActiveNavLink(gt.initialRoute.url),await C.init()}applayRouteChange({oldUrl:t,newUrl:e,newPage:s}){t!==gt.pages.game.route.url||this.gameStoppedByButton||this.headerView.nextState(),s&&this.pageContainer.render(s.view),this.headerView.menu.setActiveNavLink(e)}async handleAppStateChangeRequest(e){let s;switch(e.from){case t.INITIAL:return s=await this.processPopUp(new Ut(C)),s;case t.READY:return this.gameStoppedByButton=!1,St.activateRoute(gt.pages.game.route.url),!0;case t.GAME:return e.to===t.READY?St.getCurrentUrl()===gt.pages.game.route.url&&(this.gameStoppedByButton=!0,St.activateRoute(gt.initialRoute.url)):e.to===t.SOLVED&&(await this.processPopUp(new Pt(C)),St.activateRoute(gt.pages.score.route.url)),!0;case t.SOLVED:return!0;default:return!1}}async processPopUp(t){await this.showPopup(t);const e=await t.task();return await this.hidePopup(t),e}async showPopup(t){this.modalView.render(t),this.modalView.onClick((async()=>this.hidePopup(t))),await this.modalView.show(),await t.show()}async hidePopup(t){await Promise.all([t.hide(),this.modalView.hide()])}}window.addEventListener("load",(()=>{document.body.classList.add("root"),new Ot(document.body).start().catch((t=>console.log(t)))}))})();